cmake_minimum_required(VERSION 3.16)
project(ToDoAPI)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
    json
    GIT_REPOSITORY https://github.com/nlohmann/json.git
    GIT_TAG v3.11.2
)
FetchContent_MakeAvailable(json)

FetchContent_Declare(
    spdlog
    GIT_REPOSITORY https://github.com/gabime/spdlog.git
    GIT_TAG v1.12.0
)
FetchContent_MakeAvailable(spdlog)

FetchContent_Declare(
    googletest
    GIT_REPOSITORY https://github.com/google/googletest.git
    GIT_TAG release-1.15.0
)
FetchContent_MakeAvailable(googletest)

find_package(SQLite3 REQUIRED)
set(THREADS_PREFER_PTHREAD_FLAG ON)
find_package(Threads REQUIRED)
find_package(PkgConfig REQUIRED)
pkg_check_modules(HIREDIS REQUIRED hiredis)

set(SOURCES
    main.cpp
    logger.cpp
    metrics.cpp
    model.cpp
    repository.cpp
    service.cpp
    controller.cpp
    cache.cpp
    message_queue.cpp
    rate_limiter.cpp
)

set(HEADERS
    logger.h
    metrics.h
    model.h
    repository.h
    service.h
    controller.h
    cache.h
    message_queue.h
    rate_limiter.h
)

add_executable(todo_server ${SOURCES} ${HEADERS})

target_include_directories(todo_server PRIVATE ${HIREDIS_INCLUDE_DIRS})

target_link_libraries(todo_server PRIVATE
    nlohmann_json::nlohmann_json
    spdlog::spdlog
    SQLite::SQLite3
    ${HIREDIS_LIBRARIES}
    Threads::Threads
)

enable_testing()
add_subdirectory(tests)
